var mapSelection;var curve=[0,0,0,0];var inputSliderMin=[0,0,0,0];var inputSliderMax=[100,100,100,100];var outputSliderMin=[0,0,0,0];var outputSliderMax=[127,127,127,127];var consoleEntries=0;var customFingeringFills=[[null,null,null,null,null,null,null,null,null,null,null],[0,74,73,72,71,69,67,66,64,62,61],[0,74,72,72,70,68,67,65,64,62,61],[0,74,74,72,72,69,68,67,65,62,60]];var communicationMode=false;var midiNotes=[];var currentVersion=21;var midiAccess=null;var WARBLout=null;var gExportProxy=null;var gPressureGraphEnabled=false;var gCurrentPressure=0;var gGraphInterval=null;var gNPressureReadings=100;var gMaxPressure=25;var gPressureReadings=[];var on,off;var deviceName;var volume=0;var currentNote=62;var sensorValue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var buttonRowWrite;var jumpFactorWrite;var fingeringWrite;var version="Unknown";var instrument=0;var ping=0;var lsb=0;var defaultInstr=0;var modals=new Array;for(var w=1;w<=23;w++){modals[w]=document.getElementById("open-modal"+w)}if(platform=="app"){document.getElementById("myTopnav").style.display="none";document.getElementById("topLogo").style.display="none";document.getElementById("importexport").style.display="none"}window.onclick=function(event){for(var i=1;i<=23;i++){if(event.target==modals[i]){modalclose(i)}}event.stopPropagation()};window.addEventListener("load",function(){WARBLout=null;updateCells();for(var i=1;i<13;i++){var k=document.getElementById("jumpFactor"+i);k.dispatchEvent(new Event("input"));if(i==10){var k=document.getElementById("jumpFactor10b");k.dispatchEvent(new Event("input"))}}depth.dispatchEvent(new Event("input"));$(".volume").click(function(){toggleOn();$(this).find("i").toggleClass("fa-volume-up fa-volume-off")});if(navigator.requestMIDIAccess)navigator.requestMIDIAccess({sysex:false}).then(onMIDIInit,onMIDIReject);else alert("Your browser does not support MIDI. Please use Chrome or Opera, or the free WARBL iOS app.")});function showWARBLNotDetected(){communicationMode=false;document.getElementById("status").innerHTML="WARBL not detected.";document.getElementById("status").style.color="#F78339";document.getElementById("version").style.color="#F78339";document.getElementById("connect").innerHTML="Connect to WARBL";document.getElementById("pressure").innerHTML="";for(var m=0;m<9;m++){document.getElementById("dot"+m).style.backgroundColor="#333";if(m==0){document.getElementById("dot0").style.opacity="0"}}$("#importPreset").attr("disabled","disabled")}function showWARBLUnknown(){document.getElementById("version").innerHTML="Unknown";document.getElementById("current").style.visibility="hidden";document.getElementById("status").style.visibility="visible";document.getElementById("connect").innerHTML="Connect to WARBL";$("#importPreset").attr("disabled","disabled")}function connect(){if(communicationMode&&version>2){sendToAll(102,99);communicationMode=false;showWARBLNotDetected();showWARBLUnknown();WARBLout=null;document.getElementById("connect").innerHTML="Connect to WARBL";if(midiAccess){var inputs=midiAccess.inputs.values();for(var input=inputs.next();input&&!input.done;input=inputs.next()){input.value.onmidimessage=null}}midiAccess=null;WARBLout=null;ping=0}else{if(midiAccess){var inputs=midiAccess.inputs.values();for(var input=inputs.next();input&&!input.done;input=inputs.next()){input.value.onmidimessage=null}}midiAccess=null;WARBLout=null;ping=0;showWARBLNotDetected();showWARBLUnknown();if(navigator.requestMIDIAccess)navigator.requestMIDIAccess({sysex:false}).then(onMIDIInit,onMIDIReject);else{alert("Your browser does not support MIDI. Please use Chrome or Opera, or the free WARBL iOS app.")}}}function onMIDIInit(midi){midiAccess=midi;WARBLout=null;var foundMIDIInputDevice=false;var inputs=midiAccess.inputs.values();for(var input=inputs.next();input&&!input.done;input=inputs.next()){foundMIDIInputDevice=true;deviceName=input.value.name;setPing();input.value.onmidimessage=WARBL_Receive}if(foundMIDIInputDevice){if(!communicationMode||version<2.1||version=="Unknown"){sendToAll(102,126)}}else{showWARBLNotDetected()}midi.onstatechange=midiOnStateChange}function onMIDIReject(err){alert("The MIDI system failed to start. Please refresh the page.")}function midiOnStateChange(event){if(ping==1){showWARBLNotDetected();showWARBLUnknown();WARBLout=null;document.getElementById("connect").innerHTML="Connect to WARBL"}}function setPing(){setTimeout(function(){ping=1},3e3)}function buildMessage(byte2,byte3){if(!(byte2==102&&byte3==127)&&!(byte2==106&&byte3==42)){blink(1)}if(byte2==102){if(byte3==19){blink(3);for(var i=1;i<10;i++){document.getElementById("v"+i).innerHTML="0"}for(var i=0;i<19;i++){sensorValue[i]=0}}if(isEven(byte3)&&byte3<19){sensorValue[byte3-2]++;document.getElementById("v"+(byte3>>1)).innerHTML=sensorValue[byte3-2]}if(isOdd(byte3)&&byte3<19){sensorValue[byte3-1]--;document.getElementById("v"+(byte3+1>>1)).innerHTML=sensorValue[byte3-1];checkMax(byte3+1>>1)}}cc=[182,byte2,byte3];return cc}function sendToAll(byte2,byte3){var cc=buildMessage(byte2,byte3);var iter=midiAccess.outputs.values();for(var o=iter.next();!o.done;o=iter.next()){o.value.send(cc,window.performance.now())}}function sendToWARBL(byte2,byte3){if(communicationMode){if(platform="app"){var cc=buildMessage(byte2,byte3);var iter=midiAccess.outputs.values();for(var o=iter.next();!o.done;o=iter.next()){o.value.send(cc,window.performance.now())}}else{if(!WARBLout){console.error("sendToWARBL: No MIDI port selected!");return}var cc=buildMessage(byte2,byte3);WARBLout.send(cc,window.performance.now())}}}function WARBL_Receive(event){var data0=event.data[0];var data1=event.data[1];var data2=event.data[2];if(gExportProxy){gExportProxy(data0,data1,data2);return}if(!WARBLout&&(data0&15)==6){if(platform=="web"){var inputName=event.target.name;var inputBracketIndex=inputName.indexOf("[");if(inputName.indexOf("[")!=-1){inputName=inputName.substr(0,inputBracketIndex)}var iter=midiAccess.outputs.values();for(var o=iter.next();!o.done;o=iter.next()){var outputName=o.value.name;var outputBracketIndex=outputName.indexOf("[");if(outputName.indexOf("[")!=-1){outputName=outputName.substr(0,outputBracketIndex)}if(outputName==inputName){WARBLout=o.value;break}}if(!WARBLout){showWARBLNotDetected()}}else{WARBLout=1}}var e;var f;var g;if(isNaN(data2)){f=" "}else{f=data2}if((data0&240)==144){e="On"}if((data0&240)==128){e="Off"}if((data0&240)==176){e="CC"}if((data0&240)==224){e="PB"}if((data0&240)==192){e="PC"}if((data0&240)==208){e="CP"}if((data0&240)==160){e="KP"}if(!(e=="CC"&&parseFloat(data0&15)==6)){consoleEntries++;if(consoleEntries<301){document.getElementById("console").innerHTML+=e+" "+((data0&15)+1)+" "+data1+" "+f;document.getElementById("console").innerHTML+="<br>"}else if(consoleEntries==301){document.getElementById("console").innerHTML+="max lines reached"}var elem2=document.getElementById("console");elem2.scrollTop=elem2.scrollHeight}switch(data0&240){case 144:if(data2!=0){noteOn(data1);logKeys;return}case 128:noteOff(data1);logKeys;return;case 176:if(parseFloat(data0&15)==6){$("#importPreset").removeAttr("disabled");if(data1==115){var byteA=data2;for(var m=0;m<7;m++){if(bit_test(byteA,m)==1){document.getElementById("dot"+m).style.backgroundColor="blue";if(m==0){document.getElementById("dot0").style.opacity="0.8"}}else{document.getElementById("dot"+m).style.backgroundColor="#333";if(m==0){document.getElementById("dot0").style.opacity="0"}}}}if(data1==114){for(var n=0;n<2;n++){var byteB=data2;if(bit_test(byteB,n)==1){document.getElementById("dot"+(7+n)).style.backgroundColor="blue"}else{if(n==1){document.getElementById("dot"+(7+n)).style.backgroundColor="#181818"}if(n==0){document.getElementById("dot"+(7+n)).style.backgroundColor="#333"}}}}else if(data1==102){if(data2>19&&data2<30){document.getElementById("v"+(data2-19)).innerHTML="MAX";checkMax(data2-19)}for(var i=0;i<3;i++){if(data2==30+i){fingeringWrite=i}if(data2>32&&data2<60){if(fingeringWrite==i){document.getElementById("fingeringSelect"+i).value=data2-33}updateCells()}}if(data2==60){document.getElementById("fingering0").checked=true;instrument=0;document.getElementById("instrument0").style.display="block";document.getElementById("instrument1").style.display="none";document.getElementById("instrument2").style.display="none";document.getElementById("key0").style.display="block";document.getElementById("key1").style.display="none";document.getElementById("key2").style.display="none";handleDefault();advancedOkay();pressureOkay();updateCells();okayCCmap();okayOverride();advancedOkayPB();customFingeringOkay()}if(data2==61){document.getElementById("fingering1").checked=true;instrument=1;document.getElementById("instrument0").style.display="none";document.getElementById("instrument1").style.display="block";document.getElementById("instrument2").style.display="none";document.getElementById("key0").style.display="none";document.getElementById("key1").style.display="block";document.getElementById("key2").style.display="none";advancedOkay();pressureOkay();updateCells();advancedOkayPB();okayCCmap();okayOverride();handleDefault();customFingeringOkay()}if(data2==62){document.getElementById("fingering2").checked=true;instrument=2;document.getElementById("instrument0").style.display="none";document.getElementById("instrument1").style.display="none";document.getElementById("instrument2").style.display="block";document.getElementById("key0").style.display="none";document.getElementById("key1").style.display="none";document.getElementById("key2").style.display="block";advancedOkay();pressureOkay();updateCells();advancedOkayPB();okayCCmap();okayOverride();handleDefault();customFingeringOkay()}if(data2==85){defaultInstr=0;handleDefault()}if(data2==86){defaultInstr=1;handleDefault()}if(data2==87){defaultInstr=2;handleDefault()}if(data2==70){document.getElementById("pitchbendradio0").checked=true;updateCustom();updateCustom()}if(data2==71){document.getElementById("pitchbendradio1").checked=true;updateCustom();updateCustom()}if(data2==72){document.getElementById("pitchbendradio2").checked=true;updateCustom();updateCustom()}if(data2==73){document.getElementById("pitchbendradio3").checked=true;updateCustom();updateCustom()}if(data2==80){document.getElementById("sensorradio0").checked=true}if(data2==81){document.getElementById("sensorradio1").checked=true}if(data2==82){document.getElementById("sensorradio2").checked=true}if(data2==83){document.getElementById("sensorradio3").checked=true}if(data2==121){document.getElementById("bellSensor").style.opacity=1;document.getElementById("1").disabled=false;document.getElementById("2").disabled=false;document.getElementById("v1").classList.add("sensorValueEnabled")}if(data2==120){document.getElementById("bellSensor").style.opacity=.1;document.getElementById("1").disabled=true;document.getElementById("2").disabled=true;document.getElementById("v1").classList.remove("sensorValueEnabled")}for(var i=0;i<8;i++){if(data2==90+i){buttonRowWrite=i}}for(var j=0;j<8;j++){if(buttonRowWrite==j){if(data2==119){document.getElementById("row"+buttonRowWrite).value=19}for(var k=0;k<12;k++){if(data2==100+k){document.getElementById("row"+buttonRowWrite).value=k}if(k<5&&data2==112+k){document.getElementById("MIDIrow"+buttonRowWrite).value=k;updateCells()}}}}for(var l=0;l<3;l++){if(buttonRowWrite==l){if(data2==117){document.getElementById("checkbox"+l).checked=false}if(data2==118){document.getElementById("checkbox"+l).checked=true}}}}else if(data1==103){document.getElementById("senseDistance").value=0-data2}else if(data1==117){document.getElementById("depth").value=data2+1;var output=document.getElementById("demo14");depth.dispatchEvent(new Event("input"));output.innerHTML=data2+1}else if(data1==104){jumpFactorWrite=data2}else if(data1==105&&jumpFactorWrite<13){document.getElementById("jumpFactor"+jumpFactorWrite).value=data2;if(jumpFactorWrite==10){document.getElementById("jumpFactor10b").value=data2}for(var i=1;i<13;i++){var k=document.getElementById("jumpFactor"+i);k.dispatchEvent(new Event("input"));if(i==10){var k=document.getElementById("jumpFactor10b");k.dispatchEvent(new Event("input"))}}}if(data1==105){if(jumpFactorWrite==13){document.getElementById("checkbox6").checked=data2}else if(jumpFactorWrite==14){document.getElementById("expressionDepth").value=data2}else if(jumpFactorWrite==15){document.getElementById("checkbox7").checked=data2;updateCustom()}else if(jumpFactorWrite==16){curve[0]=data2}else if(jumpFactorWrite==17){document.getElementById("pressureChannel").value=data2}else if(jumpFactorWrite==18){document.getElementById("pressureCC").value=data2}else if(jumpFactorWrite==19){inputSliderMin[0]=data2;slider.noUiSlider.set([data2,null])}else if(jumpFactorWrite==20){inputSliderMax[0]=data2;slider.noUiSlider.set([null,data2])}else if(jumpFactorWrite==21){outputSliderMin[0]=data2;slider2.noUiSlider.set([data2,null])}else if(jumpFactorWrite==22){outputSliderMax[0]=data2;slider2.noUiSlider.set([null,data2])}else if(jumpFactorWrite==23){document.getElementById("dronesOnCommand").value=data2}else if(jumpFactorWrite==24){document.getElementById("dronesOnChannel").value=data2}else if(jumpFactorWrite==25){document.getElementById("dronesOnByte2").value=data2}else if(jumpFactorWrite==26){document.getElementById("dronesOnByte3").value=data2}else if(jumpFactorWrite==27){document.getElementById("dronesOffCommand").value=data2}else if(jumpFactorWrite==28){document.getElementById("dronesOffChannel").value=data2}else if(jumpFactorWrite==29){document.getElementById("dronesOffByte2").value=data2}else if(jumpFactorWrite==30){document.getElementById("dronesOffByte3").value=data2}else if(jumpFactorWrite==31&&data2==0){document.getElementById("dronesRadio0").checked=true}else if(jumpFactorWrite==31&&data2==1){document.getElementById("dronesRadio1").checked=true}else if(jumpFactorWrite==31&&data2==2){document.getElementById("dronesRadio2").checked=true}else if(jumpFactorWrite==31&&data2==3){document.getElementById("dronesRadio3").checked=true}else if(jumpFactorWrite==32){lsb=data2}else if(jumpFactorWrite==33){var x=parseInt(data2<<7|lsb);x=(x-100)*24/900;var p=x.toFixed(1);p=Math.min(Math.max(p,0),24);document.getElementById("dronesPressureInput").value=p}else if(jumpFactorWrite==34){lsb=data2}else if(jumpFactorWrite==35){var x=parseInt(data2<<7|lsb);x=(x-100)*24/900;var p=x.toFixed(1);p=Math.min(Math.max(p,0),24);document.getElementById("octavePressureInput").value=p}else if(jumpFactorWrite==43){document.getElementById("checkbox9").checked=data2}else if(jumpFactorWrite==44){document.getElementById("checkbox5").checked=data2;updateCustom()}else if(jumpFactorWrite==42){document.getElementById("checkbox3").checked=data2}else if(jumpFactorWrite==40){updateSelected();document.getElementById("checkbox4").checked=data2;if(data2==0){document.getElementById("bagBreath0").checked=true}else{document.getElementById("bagBreath1").checked=true}}else if(jumpFactorWrite==41){document.getElementById("checkbox8").checked=data2}else if(jumpFactorWrite==45){document.getElementById("checkbox10").checked=data2}else if(jumpFactorWrite==46){document.getElementById("checkbox11").checked=data2&1;document.getElementById("checkbox13").checked=data2&2}else if(jumpFactorWrite==47){document.getElementById("checkbox12").checked=data2}else if(jumpFactorWrite==48){document.getElementById("checkbox14").checked=data2}else if(jumpFactorWrite==49){document.getElementById("checkbox15").checked=data2}else if(jumpFactorWrite==50){document.getElementById("checkbox16").checked=data2}else if(jumpFactorWrite==51){document.getElementById("checkbox17").checked=data2}else if(jumpFactorWrite==52){document.getElementById("checkbox18").checked=data2;updateCustom()}else if(jumpFactorWrite==53){document.getElementById("checkbox19").checked=data2;updateCustom()}else if(jumpFactorWrite==61){document.getElementById("midiBendRange").value=data2}else if(jumpFactorWrite==62){document.getElementById("noteChannel").value=data2}else if(jumpFactorWrite==70){inputSliderMin[1]=data2;slider.noUiSlider.set([data2,null])}else if(jumpFactorWrite==71){inputSliderMax[1]=data2;slider.noUiSlider.set([null,data2])}else if(jumpFactorWrite==72){outputSliderMin[1]=data2;slider2.noUiSlider.set([data2,null])}else if(jumpFactorWrite==73){outputSliderMax[1]=data2;slider2.noUiSlider.set([null,data2])}else if(jumpFactorWrite==74){inputSliderMin[2]=data2;slider.noUiSlider.set([data2,null])}else if(jumpFactorWrite==75){inputSliderMax[2]=data2;slider.noUiSlider.set([null,data2])}else if(jumpFactorWrite==76){outputSliderMin[2]=data2;slider2.noUiSlider.set([data2,null])}else if(jumpFactorWrite==77){outputSliderMax[2]=data2;slider2.noUiSlider.set([null,data2])}else if(jumpFactorWrite==78){inputSliderMin[3]=data2;slider.noUiSlider.set([data2,null])}else if(jumpFactorWrite==79){inputSliderMax[3]=data2;slider.noUiSlider.set([null,data2])}else if(jumpFactorWrite==80){outputSliderMin[3]=data2;slider2.noUiSlider.set([data2,null])}else if(jumpFactorWrite==81){outputSliderMax[3]=data2;slider2.noUiSlider.set([null,data2])}else if(jumpFactorWrite==85){slider3.noUiSlider.set([data2,null])}else if(jumpFactorWrite==86){slider3.noUiSlider.set([null,data2])}else if(jumpFactorWrite==82){curve[1]=data2}else if(jumpFactorWrite==83){curve[2]=data2}else if(jumpFactorWrite==84){curve[3]=data2}else if(jumpFactorWrite>86&&jumpFactorWrite<98){document.getElementById("fingeringInput"+(jumpFactorWrite-86)).value=data2}}else if(data1==110){version=data2;if(version==currentVersion){document.getElementById("current").innerHTML="Your firmware is up to date.";document.getElementById("current").style.left="710px";document.getElementById("current").style.visibility="visible";document.getElementById("status").style.visibility="hidden";document.getElementById("current").style.color="#f7c839"}else{document.getElementById("current").innerHTML="There is a firmware update available.";document.getElementById("current").style.left="690px";document.getElementById("current").style.visibility="visible";document.getElementById("status").style.visibility="hidden";document.getElementById("current").style.color="#F78339"}version=version/10;var n=version.toFixed(1);document.getElementById("version").innerHTML=n;document.getElementById("version").style.color="#f7c839";document.getElementById("status").innerHTML="WARBL Connected.";document.getElementById("status").style.color="#f7c839";communicationMode=true;if(version>2){document.getElementById("connect").innerHTML="Disconnect"}if(version<2.1){document.getElementById("jumpfactor10Container").style.visibility="visible";document.getElementById("jumpfactor4Container").style.visibility="visible";document.getElementById("jumpValue4").style.visibility="visible";document.getElementById("jumpValue10").style.visibility="visible";document.getElementById("jumpfactor10bContainer").style.visibility="hidden";document.getElementById("jumpLabel8").style.visibility="hidden";document.getElementById("jumpLabel5").style.visibility="visible";document.getElementById("demo10b").style.visibility="hidden";document.getElementById("jumpLabel4").innerHTML="Jump";document.getElementById("jumpfactor5Container").style.top="240px";document.getElementById("jumpfactor6Container").style.top="275px";document.getElementById("jumpfactor11Container").style.top="240px";document.getElementById("jumpfactor12Container").style.top="275px";document.getElementById("jumplabel6").style.top="242px";document.getElementById("jumplabel7").style.top="277px";document.getElementById("jumpValue5").style.top="225px";document.getElementById("jumpValue6").style.top="260px";document.getElementById("jumpValue11").style.top="225px";document.getElementById("jumpValue12").style.top="260px";document.getElementById("jumpFactor3").min="1";document.getElementById("jumpFactor3").max="175";document.getElementById("jumpFactor9").min="1";document.getElementById("jumpFactor9").max="175";document.getElementById("jumpFactor5").min="1";document.getElementById("jumpFactor6").min="1";document.getElementById("jumpFactor11").min="1";document.getElementById("jumpFactor12").min="1";document.getElementById("breathSlider").classList.remove("slider2");document.getElementById("breathSlider").classList.add("slider");document.getElementById("pressureGroup").style.top="0px";document.getElementById("ventedLabel").style.visibility="visible";document.getElementById("switch4").style.visibility="visible";document.getElementById("radioGroup10").style.visibility="hidden";document.getElementById("jumplabel10").innerHTML="Closed";document.getElementById("jumplabel11").innerHTML="Vented";document.getElementById("jumplabel10").style.left="170px";document.getElementById("jumplabel11").style.left="340px";document.getElementById("advancedSliders").style.top="-125px";document.getElementById("selectedSettings").style.visibility="hidden";document.getElementById("fingeringSelect0").options[19].disabled=true;document.getElementById("fingeringSelect1").options[19].disabled=true;document.getElementById("fingeringSelect2").options[19].disabled=true;document.getElementById("fingeringSelect0").options[20].disabled=true;document.getElementById("fingeringSelect1").options[20].disabled=true;document.getElementById("fingeringSelect2").options[20].disabled=true}if(version<2){document.getElementById("overrideExpression").disabled=true;document.getElementById("polyMapButton").disabled=true;document.getElementById("velocityMapButton").disabled=true;document.getElementById("aftertouchMapButton").disabled=true;document.getElementById("noteChannel").disabled=true;document.getElementById("checkbox13").disabled=true;document.getElementById("switch13").style.cursor="default";document.getElementById("advancedPBbutton").disabled=true;document.getElementById("pitchbendradio3").disabled=true;document.getElementById("configureCustomFingering").disabled=true}if(version<1.5){document.getElementById("fingeringSelect0").options[2].disabled=true;document.getElementById("fingeringSelect1").options[2].disabled=true;document.getElementById("fingeringSelect2").options[2].disabled=true;document.getElementById("checkbox10").disabled=true;for(var i=0;i<8;i++){document.getElementById("row"+i).options[7].disabled=true;document.getElementById("row"+i).options[8].disabled=true}}if(version<1.6){for(var i=0;i<8;i++){document.getElementById("row"+i).options[12].disabled=true}document.getElementById("fingeringSelect0").options[6].disabled=true;document.getElementById("fingeringSelect1").options[6].disabled=true;document.getElementById("fingeringSelect2").options[6].disabled=true;document.getElementById("fingeringSelect0").options[11].disabled=true;document.getElementById("fingeringSelect1").options[11].disabled=true;document.getElementById("fingeringSelect2").options[11].disabled=true}if(version<1.7){document.getElementById("checkbox11").disabled=true;document.getElementById("checkbox12").disabled=true;document.getElementById("fingeringSelect0").options[12].disabled=true;document.getElementById("fingeringSelect1").options[12].disabled=true;document.getElementById("fingeringSelect2").options[12].disabled=true;document.getElementById("fingeringSelect0").options[13].disabled=true;document.getElementById("fingeringSelect1").options[13].disabled=true;document.getElementById("fingeringSelect2").options[13].disabled=true;document.getElementById("fingeringSelect0").options[14].disabled=true;document.getElementById("fingeringSelect1").options[14].disabled=true;document.getElementById("fingeringSelect2").options[14].disabled=true;document.getElementById("fingeringSelect0").options[15].disabled=true;document.getElementById("fingeringSelect1").options[15].disabled=true;document.getElementById("fingeringSelect2").options[15].disabled=true}if(version<2){document.getElementById("fingeringSelect0").options[16].disabled=true;document.getElementById("fingeringSelect1").options[16].disabled=true;document.getElementById("fingeringSelect2").options[16].disabled=true;document.getElementById("fingeringSelect0").options[17].disabled=true;document.getElementById("fingeringSelect1").options[17].disabled=true;document.getElementById("fingeringSelect2").options[17].disabled=true;document.getElementById("fingeringSelect0").options[18].disabled=true;document.getElementById("fingeringSelect1").options[18].disabled=true;document.getElementById("fingeringSelect2").options[18].disabled=true}}else if(data1==111){document.getElementById("keySelect0").value=data2}else if(data1==112){document.getElementById("keySelect1").value=data2}else if(data1==113){document.getElementById("keySelect2").value=data2}else if(data1==116){lsb=data2}else if(data1==118){var x=parseInt(data2<<7|lsb);x=(x-100)*24/900;p=Math.min(Math.max(p,0),24);var p=x.toFixed(1);if(p<.2){p=0}if(gPressureGraphEnabled){capturePressure(p)}else{document.getElementById("pressure").innerHTML=p;document.getElementById("pressure1").innerHTML=p}}for(var i=0;i<8;i++){if(buttonRowWrite==i){if(data1==106&&data2<16){document.getElementById("channel"+buttonRowWrite).value=data2}if(data1==107){document.getElementById("byte2_"+buttonRowWrite).value=data2}if(data1==108){document.getElementById("byte3_"+buttonRowWrite).value=data2}}}if(data1==106&&data2>15){if(data2>19&&data2<29){document.getElementById("vibratoCheckbox"+(data2-20)).checked=false}if(data2>29&&data2<39){document.getElementById("vibratoCheckbox"+(data2-30)).checked=true}if(data2==39){document.getElementById("calibrateradio0").checked=true}if(data2==40){document.getElementById("calibrateradio1").checked=true}if(data2==53){for(i=0;i<document.getElementById("fingeringSelect0").length;++i){if(document.getElementById("fingeringSelect0").options[i].value=="9"){var a=1}}if(a!=1){var x=document.getElementById("fingeringSelect0");var option=document.createElement("option");option.text="Uilleann regulators";option.value=9;x.add(option);var y=document.getElementById("fingeringSelect1");var option=document.createElement("option");option.text="Uilleann regulators";option.value=9;y.add(option);var z=document.getElementById("fingeringSelect2");var option=document.createElement("option");option.text="Uilleann regulators";option.value=9;z.add(option)}}}}}updateCells()}function bit_test(num,bit){return(num>>bit)%2!=0}function sendCustomFingeringFill(){modalclose(22);var value=document.getElementById("customFingeringFill").value;for(i=1;i<12;++i){document.getElementById("fingeringInput"+i).value=customFingeringFills[value][i-1];fingeringInput(i,customFingeringFills[value][i-1])}}function sendFingeringSelect(row,selection){selection=parseFloat(selection);updateCells();updateCustom();blink(1);var key;if(selection==2){key=8}else if(selection==3){key=3}else if(selection==5||selection==13){key=125}else if(selection==6){key=122}else if(selection==8){key=125}else if(selection==11){key=113}else if(selection==12||selection==14||selection==15){key=123}else if(selection==17||selection==18){key=2}else if(selection==20){key=123}else if(selection==22){key=5}else{key=0}document.getElementById("keySelect"+row).value=key;sendToWARBL(102,30+row);sendToWARBL(102,33+selection);sendKey(row,key)}function fingeringInput(input,selection){var x=document.getElementById("fingeringInput"+input).value;if(x<0||x>127||isNaN(x)){alert("Value must be 0-127.");document.getElementById("fingeringInput"+input).value=null}else{blink(1);document.getElementById("customFingeringFill").value="12";sendToWARBL(104,86+input);sendToWARBL(105,selection)}}function defaultInstrument(){defaultInstr=instrument;handleDefault();sendToWARBL(102,85)}function handleDefault(){if(version>1.6||version=="Unknown"){if(defaultInstr!=0){document.getElementById("instrument1Label").innerHTML="Instrument 1:"}if(defaultInstr!=1){document.getElementById("instrument2Label").innerHTML="Instrument 2:"}if(defaultInstr!=2){document.getElementById("instrument3Label").innerHTML="Instrument 3:"}if(defaultInstr==0){document.getElementById("instrument1Label").innerHTML="Instrument 1 (default):"}if(defaultInstr==1){document.getElementById("instrument2Label").innerHTML="Instrument 2 (default):"}if(defaultInstr==2){document.getElementById("instrument3Label").innerHTML="Instrument 3 (default):"}if(defaultInstr!=instrument){document.getElementById("defaultInstrument").style.visibility="visible";if(instrument==0){document.getElementById("defaultInstrument").style.left="130px"}if(instrument==1){document.getElementById("defaultInstrument").style.left="430px"}if(instrument==2){document.getElementById("defaultInstrument").style.left="730px"}}else{document.getElementById("defaultInstrument").style.visibility="hidden"}}}function sendKey(row,selection){selection=parseFloat(selection);row=parseFloat(row);updateCells();blink(1);sendToWARBL(111+row,selection)}function sendFingeringRadio(tab){instrument=tab;updateCustom();advancedOkay();pressureOkay();handleDefault();customFingeringOkay();if(tab==0){document.getElementById("instrument0").style.display="block";document.getElementById("instrument1").style.display="none";document.getElementById("instrument2").style.display="none";document.getElementById("key0").style.display="block";document.getElementById("key1").style.display="none";document.getElementById("key2").style.display="none";sendToWARBL(102,60)}else if(tab==1){document.getElementById("instrument0").style.display="none";document.getElementById("instrument1").style.display="block";document.getElementById("instrument2").style.display="none";document.getElementById("key0").style.display="none";document.getElementById("key1").style.display="block";document.getElementById("key2").style.display="none";blink(2);sendToWARBL(102,61)}else if(tab==2){document.getElementById("instrument0").style.display="none";document.getElementById("instrument1").style.display="none";document.getElementById("instrument2").style.display="block";document.getElementById("key0").style.display="none";document.getElementById("key1").style.display="none";document.getElementById("key2").style.display="block";blink(3);sendToWARBL(102,62)}updateCells();updateCustom()}function updateSelected(){if(document.getElementById("bagBreath0").checked==true){document.getElementById("selectedSettings").style.left="125px";document.getElementById("selectedSettings").style.width="162px"}else{document.getElementById("selectedSettings").style.left="285px";document.getElementById("selectedSettings").style.width="162px"}}function sendSenseDistance(selection){blink(1);selection=parseFloat(selection);x=0-parseFloat(selection);sendToWARBL(103,x)}function sendDepth(selection){blink(1);selection=parseFloat(selection);sendToWARBL(117,selection)}function sendExpressionDepth(selection){blink(1);selection=parseFloat(selection);sendToWARBL(104,14);sendToWARBL(105,selection)}function sendCurveRadio(selection){blink(1);selection=parseFloat(selection);curve[mapSelection]=selection;if(mapSelection==0){sendToWARBL(104,16)}else{sendToWARBL(104,81+mapSelection)}sendToWARBL(105,selection)}function sendPressureChannel(selection){blink(1);var x=parseFloat(selection);if(x<1||x>16||isNaN(x)){alert("Value must be 1-16.");document.getElementById("pressureChannel").value=null}else{sendToWARBL(104,17);sendToWARBL(105,x)}}function sendPressureCC(selection){blink(1);selection=parseFloat(selection);sendToWARBL(104,18);sendToWARBL(105,selection)}function sendBendRange(selection){blink(1);var x=parseFloat(selection);if(x<1||x>96||isNaN(x)){alert("Value must be 1-96.");document.getElementById("midiBendRange").value=null}else{sendToWARBL(104,61);sendToWARBL(105,x)}}function sendNoteChannel(selection){blink(1);var x=parseFloat(selection);if(x<1||x>16||isNaN(x)){alert("Value must be 1-16.");document.getElementById("noteChannel").value=null}else{sendToWARBL(104,62);sendToWARBL(105,x)}}slider.noUiSlider.on("change",function(values){blink(1);if(mapSelection==0){inputSliderMin[0]=parseInt(values[0]);inputSliderMax[0]=parseInt(values[1]);sendToWARBL(104,19);sendToWARBL(105,parseInt(values[0]));sendToWARBL(104,20);sendToWARBL(105,parseInt(values[1]))}else{inputSliderMin[mapSelection]=parseInt(values[0]);inputSliderMax[mapSelection]=parseInt(values[1]);sendToWARBL(104,70+(mapSelection-1)*4);sendToWARBL(105,parseInt(values[0]));sendToWARBL(104,71+(mapSelection-1)*4);sendToWARBL(105,parseInt(values[1]))}});slider2.noUiSlider.on("change",function(values){blink(1);if(mapSelection==0){outputSliderMin[0]=parseInt(values[0]);outputSliderMax[0]=parseInt(values[1]);sendToWARBL(104,21);sendToWARBL(105,parseInt(values[0]));sendToWARBL(104,22);sendToWARBL(105,parseInt(values[1]))}else{outputSliderMin[mapSelection]=parseInt(values[0]);outputSliderMax[mapSelection]=parseInt(values[1]);sendToWARBL(104,72+(mapSelection-1)*4);sendToWARBL(105,parseInt(values[0]));sendToWARBL(104,73+(mapSelection-1)*4);sendToWARBL(105,parseInt(values[1]))}});slider3.noUiSlider.on("change",function(values){blink(1);sendToWARBL(104,85);sendToWARBL(105,parseInt(values[0]));sendToWARBL(104,86);sendToWARBL(105,parseInt(values[1]))});slider.noUiSlider.on("update",function(values,handle){var marginMin=document.getElementById("slider-value-min"),marginMax=document.getElementById("slider-value-max");if(handle){var min=parseFloat(values[handle]*.24).toFixed(1);marginMax.innerHTML=min}else{var max=parseFloat(values[handle]*.24).toFixed(1);marginMin.innerHTML=max}});slider2.noUiSlider.on("update",function(values,handle){var marginMin=document.getElementById("slider2-value-min"),marginMax=document.getElementById("slider2-value-max");if(handle){marginMax.innerHTML=parseInt(values[handle])}else{marginMin.innerHTML=parseInt(values[handle])}});slider3.noUiSlider.on("update",function(values,handle){var marginMin=document.getElementById("slider3-value-min"),marginMax=document.getElementById("slider3-value-max");if(handle){var min=parseFloat(values[handle]*.24).toFixed(1);marginMax.innerHTML=min}else{var max=parseFloat(values[handle]*.24).toFixed(1);marginMin.innerHTML=max}});function sendDronesOnCommand(selection){blink(1);selection=parseFloat(selection);sendToWARBL(104,23);sendToWARBL(105,selection)}function sendDronesOnChannel(selection){var x=parseFloat(selection);if(x<0||x>16||isNaN(x)){alert("Value must be 1-16.");document.getElementById("dronesOnChannel").value=null}else{blink(1);sendToWARBL(104,24);sendToWARBL(105,x)}}function sendDronesOnByte2(selection){var x=parseFloat(selection);if(x<0||x>127||isNaN(x)){alert("Value must be 0 - 127.");document.getElementById("dronesOnByte2").value=null}else{blink(1);sendToWARBL(104,25);sendToWARBL(105,x)}}function sendDronesOnByte3(selection){var x=parseFloat(selection);if(x<0||x>127||isNaN(x)){alert("Value must be 0 - 127.");document.getElementById("dronesOnByte3").value=null}else{blink(1);sendToWARBL(104,26);sendToWARBL(105,x)}}function sendDronesOffCommand(selection){blink(1);var y=parseFloat(selection);sendToWARBL(104,27);sendToWARBL(105,y)}function sendDronesOffChannel(selection){var x=parseFloat(selection);if(x<0||x>16||isNaN(x)){alert("Value must be 1-16.");document.getElementById("dronesOffChannel").value=null}else{blink(1);sendToWARBL(104,28);sendToWARBL(105,x)}}function sendDronesOffByte2(selection){var x=parseFloat(selection);if(x<0||x>127||isNaN(x)){alert("Value must be 0 - 127.");document.getElementById("dronesOffByte2").value=null}else{blink(1);sendToWARBL(104,29);sendToWARBL(105,x)}}function sendDronesOffByte3(selection){var x=parseFloat(selection);if(x<0||x>127||isNaN(x)){alert("Value must be 0 - 127.");document.getElementById("dronesOffByte3").value=null}else{blink(1);sendToWARBL(104,30);sendToWARBL(105,x)}}function sendDronesRadio(selection){blink(1);selection=parseFloat(selection);sendToWARBL(104,31);sendToWARBL(105,selection)}function learnDrones(){blink(1);document.getElementById("dronesPressureInput").style.backgroundColor="#32CD32";setTimeout(blinkDrones,500);sendToWARBL(106,43)}function blinkDrones(){document.getElementById("dronesPressureInput").style.backgroundColor="#FFF"}function blinkOctave(){document.getElementById("octavePressureInput").style.backgroundColor="#FFF"}function sendDronesPressure(selection){var x=parseFloat(selection);if(x<0||x>24||isNaN(x)){alert("Value must be 0.0 - 24.0.");document.getElementById("dronesPressureInput").value=null}else{x=parseInt(x*900/24+100);blink(1);document.getElementById("dronesPressureInput").style.backgroundColor="#32CD32";setTimeout(blinkDrones,500);sendToWARBL(104,32);sendToWARBL(105,x&127);sendToWARBL(104,33);sendToWARBL(105,x>>7)}}function sendOctavePressure(selection){var x=parseFloat(selection);if(x<0||x>24||isNaN(x)){alert("Value must be 0.0 - 24.0.");document.getElementById("octavePressureInput").value=null}else{x=parseInt(x*900/24+100);blink(1);document.getElementById("octavePressureInput").style.backgroundColor="#32CD32";setTimeout(blinkOctave,500);sendToWARBL(104,34);sendToWARBL(105,x&127);sendToWARBL(104,35);sendToWARBL(105,x>>7)}}function learn(){blink(1);document.getElementById("octavePressureInput").style.backgroundColor="#32CD32";setTimeout(blinkOctave,500);sendToWARBL(106,41)}function sendCalibrateRadio(selection){selection=parseFloat(selection);blink(1);sendToWARBL(106,39+selection)}function sendPitchbendRadio(selection){updateCustom();updateCustom();selection=parseFloat(selection);if(selection>0){blink(selection+1)}sendToWARBL(102,70+selection)}function sendVibratoHoles(holeNumber,selection){selection=+selection;sendToWARBL(106,30-selection*10+holeNumber)}function updateCustom(){var a=document.getElementById("fingeringSelect"+instrument).value;if(document.getElementById("pitchbendradio2").checked==false&&((a==0||a==1||a==4||a==10)&&(document.getElementById("pitchbendradio1").checked==true&&version<1.6||(version=="Unknown"||version>1.5))||(version=="Unknown"||version>1.5)&&(a==3||a==2))){document.getElementById("checkbox5").disabled=false;document.getElementById("switch5").style.cursor="pointer"}else{document.getElementById("checkbox5").disabled=true;document.getElementById("switch5").style.cursor="default"}if(document.getElementById("checkbox5").checked==true&&document.getElementById("checkbox5").disabled==false){for(var i=0;i<9;i++){document.getElementById("vibratoCheckbox"+i).disabled=true;document.getElementById("vibratoCheckbox"+i).style.cursor="default"}}else{for(var i=0;i<9;i++){document.getElementById("vibratoCheckbox"+i).disabled=false;document.getElementById("vibratoCheckbox"+i).style.cursor="pointer"}}if(document.getElementById("checkbox18").checked==true){document.getElementById("fingeringInput11").disabled=true;document.getElementById("fingeringInput11").style.cursor="default"}else{document.getElementById("fingeringInput11").disabled=false;document.getElementById("fingeringInput11").style.cursor="pointer"}}function sendBreathmodeRadio(selection){selection=parseFloat(selection);if(selection>0){blink(selection+1)}if(document.getElementById("sensorradio1").checked==true){document.getElementById("checkbox16").disabled=true}else{document.getElementById("checkbox16").disabled=false}sendToWARBL(102,80+selection)}function advanced(){document.getElementById("box2").style.display="block";document.getElementById("box1").style.display="none";updateSelected()}function advancedOkay(){document.getElementById("box2").style.display="none";document.getElementById("box1").style.display="block"}function advancedPB(){if(version>1.8||version=="Unknown"){document.getElementById("box4").style.display="block";document.getElementById("box5").style.display="none"}}function overRideExpression(){if(version>1.8||version=="Unknown"){if(document.getElementById("sensorradio1").checked==true){document.getElementById("checkbox16").disabled=true}else{document.getElementById("checkbox16").disabled=false}document.getElementById("box8").style.display="block";document.getElementById("box6").style.display="none"}}function okayOverride(){document.getElementById("box8").style.display="none";document.getElementById("box6").style.display="block"}function advancedOkayPB(){document.getElementById("box4").style.display="none";document.getElementById("box5").style.display="block"}function configureCustomFingering(){document.getElementById("topControls").style.display="none";document.getElementById("customControls").style.display="block";document.getElementById("box1").style.top="740px";document.getElementById("box2").style.top="740px";document.getElementById("box4").style.top="740px";document.getElementById("box5").style.top="740px";document.getElementById("pressuregraph").style.top="740px";document.getElementById("box3").style.top="1200px";document.getElementById("box6").style.top="1200px";document.getElementById("box7").style.top="1200px";document.getElementById("box8").style.top="1200px";document.getElementById("buttonBox").style.top="1690px";document.getElementById("topcontrolbox").style.height="2085px"}function customFingeringOkay(){document.getElementById("customControls").style.display="none";document.getElementById("topControls").style.display="block";document.getElementById("box1").style.top="440px";document.getElementById("box2").style.top="440px";document.getElementById("box4").style.top="440px";document.getElementById("box5").style.top="440px";document.getElementById("pressuregraph").style.top="440px";document.getElementById("box3").style.top="900px";document.getElementById("box6").style.top="900px";document.getElementById("box7").style.top="900px";document.getElementById("box8").style.top="900px";document.getElementById("buttonBox").style.top="1390px";document.getElementById("topcontrolbox").style.height="1785px";document.getElementById("customFingeringFill").value="12"}function mapCC(){mapSelection=0;slider.noUiSlider.set([inputSliderMin[0],inputSliderMax[0]]);slider2.noUiSlider.set([outputSliderMin[0],outputSliderMax[0]]);document.getElementById("pressureChannel").style.visibility="visible";document.getElementById("pressureCC").style.visibility="visible";document.getElementById("expressionChannel").style.visibility="visible";document.getElementById("highByte").style.visibility="visible";document.getElementById("box7").style.display="block";document.getElementById("box6").style.display="none";if(curve[0]<3){document.getElementById("curveRadio"+curve[0]).checked=true}if(version>1.8){document.getElementById("pressureMappingHeader").innerHTML="CC Mapping"}}function mapVelocity(){mapSelection=1;slider.noUiSlider.set([inputSliderMin[1],inputSliderMax[1]]);slider2.noUiSlider.set([outputSliderMin[1],outputSliderMax[1]]);if(curve[1]<3){document.getElementById("curveRadio"+curve[1]).checked=true}document.getElementById("box7").style.display="block";document.getElementById("box6").style.display="none";document.getElementById("pressureMappingHeader").innerHTML="Velocity Mapping"}function mapAftertouch(){mapSelection=2;slider.noUiSlider.set([inputSliderMin[2],inputSliderMax[2]]);slider2.noUiSlider.set([outputSliderMin[2],outputSliderMax[2]]);if(curve[2]<3){document.getElementById("curveRadio"+curve[2]).checked=true}document.getElementById("box7").style.display="block";document.getElementById("box6").style.display="none";document.getElementById("pressureMappingHeader").innerHTML="Channel Pressure Mapping"}function mapPoly(){mapSelection=3;slider.noUiSlider.set([inputSliderMin[3],inputSliderMax[3]]);slider2.noUiSlider.set([outputSliderMin[3],outputSliderMax[3]]);if(curve[3]<3){document.getElementById("curveRadio"+curve[3]).checked=true}document.getElementById("box7").style.display="block";document.getElementById("box6").style.display="none";document.getElementById("pressureMappingHeader").innerHTML="Key Pressure Mapping"}function okayCCmap(){mapSelection=4;document.getElementById("box7").style.display="none";document.getElementById("box6").style.display="block";document.getElementById("pressureChannel").style.visibility="hidden";document.getElementById("pressureCC").style.visibility="hidden";document.getElementById("expressionChannel").style.visibility="hidden";document.getElementById("highByte").style.visibility="hidden"}function pressureGraph(){document.getElementById("pressuregraph").style.display="block";document.getElementById("box1").style.display="none";startPressureGraph()}function pressureOkay(){stopPressureGraph();document.getElementById("pressuregraph").style.display="none";document.getElementById("box1").style.display="block"}function advancedDefaults(){if(version>2||version=="Unknown"){document.getElementById("jumpFactor7").value="3";document.getElementById("jumpFactor8").value="7";document.getElementById("jumpFactor9").value="20";document.getElementById("jumpFactor11").value="12";document.getElementById("jumpFactor12").value="50";for(var i=7;i<10;i++){var k=document.getElementById("jumpFactor"+i);k.dispatchEvent(new Event("input"));var j=document.getElementById("jumpFactor"+i).value;sendJumpFactor(i,j)}for(var i=11;i<13;i++){var k=document.getElementById("jumpFactor"+i);k.dispatchEvent(new Event("input"));var j=document.getElementById("jumpFactor"+i).value;sendJumpFactor(i,j)}}else{document.getElementById("jumpFactor1").value="25";document.getElementById("jumpFactor2").value="15";document.getElementById("jumpFactor3").value="15";document.getElementById("jumpFactor4").value="15";document.getElementById("jumpFactor5").value="30";document.getElementById("jumpFactor6").value="60";document.getElementById("jumpFactor7").value="3";document.getElementById("jumpFactor8").value="7";document.getElementById("jumpFactor9").value="100";document.getElementById("jumpFactor10").value="7";document.getElementById("jumpFactor11").value="9";document.getElementById("jumpFactor12").value="9";for(var i=1;i<13;i++){var k=document.getElementById("jumpFactor"+i);k.dispatchEvent(new Event("input"));var j=document.getElementById("jumpFactor"+i).value;sendJumpFactor(i,j)}}}function advancedBagDefaults(){if(version>2||version=="Unknown"){document.getElementById("jumpFactor1").value="50";document.getElementById("jumpFactor2").value="20";document.getElementById("jumpFactor3").value="20";document.getElementById("jumpFactor4").value="50";document.getElementById("jumpFactor6").value="75";for(var i=1;i<7;i++){var k=document.getElementById("jumpFactor"+i);k.dispatchEvent(new Event("input"));var j=document.getElementById("jumpFactor"+i).value;sendJumpFactor(i,j)}}else{document.getElementById("jumpFactor1").value="75";document.getElementById("jumpFactor2").value="25";document.getElementById("jumpFactor3").value="15";document.getElementById("jumpFactor4").value="15";document.getElementById("jumpFactor5").value="30";document.getElementById("jumpFactor6").value="60";document.getElementById("jumpFactor7").value="50";document.getElementById("jumpFactor8").value="20";document.getElementById("jumpFactor9").value="28";document.getElementById("jumpFactor10").value="7";document.getElementById("jumpFactor11").value="15";document.getElementById("jumpFactor12").value="22";for(var i=1;i<13;i++){var k=document.getElementById("jumpFactor"+i);k.dispatchEvent(new Event("input"));var j=document.getElementById("jumpFactor"+i).value;sendJumpFactor(i,j)}}}function sendJumpFactor(factor,selection){selection=parseFloat(selection);blink(1);sendToWARBL(104,factor);sendToWARBL(105,selection)}function sendRow(rowNum){blink(1);updateCells();sendToWARBL(102,90+rowNum);var y=100+parseFloat(document.getElementById("row"+rowNum).value);sendToWARBL(102,y);sendMIDIrow(rowNum);sendChannel(rowNum);sendByte2(rowNum);sendByte3(rowNum);if(rowNum<3){sendMomentary(rowNum)}}function sendMIDIrow(MIDIrowNum){blink(1);updateCells();sendToWARBL(102,90+MIDIrowNum);var y=112+parseFloat(document.getElementById("MIDIrow"+MIDIrowNum).value);sendToWARBL(102,y);sendChannel(MIDIrowNum);sendByte2(MIDIrowNum);sendByte3(MIDIrowNum);if(MIDIrowNum<3){sendMomentary(MIDIrowNum)}}function sendChannel(rowNum){blink(1);MIDIvalueChange();var y=parseFloat(document.getElementById("channel"+rowNum).value);sendToWARBL(102,90+rowNum);sendToWARBL(106,y)}function sendByte2(rowNum){blink(1);MIDIvalueChange();sendToWARBL(102,90+rowNum);var y=parseFloat(document.getElementById("byte2_"+rowNum).value);sendToWARBL(107,y)}function sendByte3(rowNum){blink(1);MIDIvalueChange();sendToWARBL(102,90+rowNum);var y=parseFloat(document.getElementById("byte3_"+rowNum).value);sendToWARBL(108,y)}function sendMomentary(rowNum){blink(1);updateCells();var y=document.getElementById("checkbox"+rowNum).checked;sendToWARBL(102,90+rowNum);if(y==false){sendToWARBL(102,117)}if(y==true){sendToWARBL(102,118)}}function sendVented(selection){selection=+selection;blink(1);sendToWARBL(104,40);sendToWARBL(105,selection);updateSelected()}function sendBagless(selection){selection=+selection;blink(1);sendToWARBL(104,41);sendToWARBL(105,selection)}function sendSecret(selection){selection=+selection;blink(1);sendToWARBL(104,42);sendToWARBL(105,selection)}function sendInvert(selection){selection=+selection;blink(1);sendToWARBL(104,43);sendToWARBL(105,selection)}function sendCustom(selection){selection=+selection;blink(1);updateCustom();sendToWARBL(104,44);sendToWARBL(105,selection)}function sendExpression(selection){selection=+selection;blink(1);sendToWARBL(104,13);sendToWARBL(105,selection)}function sendRawPressure(selection){selection=+selection;updateCustom();blink(1);sendToWARBL(104,15);sendToWARBL(105,selection)}function sendVelocity(selection){selection=+selection;blink(1);sendToWARBL(104,45);sendToWARBL(105,selection);updateCells()}function sendAftertouch(selection,polyselection){selection=+selection;var val=selection|+polyselection<<1;blink(1);sendToWARBL(104,46);sendToWARBL(105,val)}function sendForceVelocity(selection){selection=+selection;blink(1);sendToWARBL(104,47);sendToWARBL(105,selection)}function sendHack1(selection){selection=+selection;blink(1);sendToWARBL(104,48);sendToWARBL(105,selection)}function sendHack2(selection){selection=+selection;blink(1);sendToWARBL(104,49);sendToWARBL(105,selection)}function sendOverride(selection){selection=+selection;blink(1);sendToWARBL(104,50);sendToWARBL(105,selection)}function sendBoth(selection){selection=+selection;blink(1);sendToWARBL(104,51);sendToWARBL(105,selection)}function sendR4flatten(selection){selection=+selection;blink(1);updateCustom();sendToWARBL(104,52);sendToWARBL(105,selection)}function saveAsDefaults(){modalclose(2);blink(3);sendToWARBL(102,123)}function saveAsDefaultsForAll(){modalclose(3);blink(3);sendToWARBL(102,124)}function restoreAll(){modalclose(4);blink(3);sendToWARBL(102,125);communicationMode=0;if(version>1.9){setTimeout(connect,3e3)}}function autoCalibrateBell(){if(communicationMode){LEDon()}setTimeout(LEDoff,5e3);sendToWARBL(106,42)}function autoCalibrate(){if(communicationMode){LEDon()}setTimeout(LEDoff,1e4);sendToWARBL(102,127)}function frequencyFromNoteNumber(note){return 440*Math.pow(2,(note-69)/12)}function modal(modalId){document.getElementById("open-modal"+modalId).classList.add("modal-window-open");if(modalId==18){clearConsole()}}function modalclose(modalId){document.getElementById("open-modal"+modalId).classList.remove("modal-window-open")}function blink(blinkNum){if(communicationMode){LEDon();setTimeout(LEDoff,200);if(blinkNum>1){setTimeout(LEDon,400);setTimeout(LEDoff,600)}if(blinkNum>2){setTimeout(LEDon,800);setTimeout(LEDoff,1e3)}if(blinkNum>3){setTimeout(LEDon,1200);setTimeout(LEDoff,1400)}if(blinkNum>4){setTimeout(LEDon,1600);setTimeout(LEDoff,1800)}}}function checkMax(field){var x=document.getElementById("v"+field).textContent;if(x=="MAX"){document.getElementById(field*2).disabled=true}if(x!="MAX"){document.getElementById(field*2).disabled=false}}function isEven(n){return n%2==0}function isOdd(n){return Math.abs(n%2)==1}function LEDoff(){elements=document.getElementsByClassName("leddot");for(var i=0;i<elements.length;i++){elements[i].style.visibility="hidden"}}function LEDon(){elements=document.getElementsByClassName("leddot");for(var i=0;i<elements.length;i++){elements[i].style.visibility="visible"}}function toggleOn(){volume=+!volume;if(volume==0){noteOff(currentNote)}}function logKeys(){var s="Keys";for(var i=0;i<midiNotes.length;i++){s=s+" "+midiNotes[i].pitch}}function noteOn(pitch){noteOff(pitch);currentNote=pitch;if(volume){for(var i=0;i<_tone_0650_SBLive_sf2.zones.length;i++){_tone_0650_SBLive_sf2.zones[i].ahdsr=false}var envelope=player.queueWaveTable(audioContext,audioContext.destination,_tone_0650_SBLive_sf2,0,pitch,999,.5,true);var note={pitch:pitch,envelope:envelope};midiNotes.push(note)}}function noteOff(pitch){for(var i=0;i<midiNotes.length;i++){if(midiNotes[i].pitch==pitch){if(midiNotes[i].envelope){midiNotes[i].envelope.cancel()}midiNotes.splice(i,1);return}}}var output14=document.getElementById("demo14");var depthSlider=document.getElementById("depth");depthSlider.addEventListener("input",sliderChange);function sliderChange(){output14.innerHTML=depthSlider.value}var output1=document.getElementById("demo1");var jumpSlider1=document.getElementById("jumpFactor1");jumpSlider1.addEventListener("input",slider1Change);function slider1Change(){output1.innerHTML=jumpSlider1.value}var output2=document.getElementById("demo2");var jumpSlider2=document.getElementById("jumpFactor2");jumpSlider2.addEventListener("input",slider2Change);function slider2Change(){output2.innerHTML=jumpSlider2.value}var output3=document.getElementById("demo3");var jumpSlider3=document.getElementById("jumpFactor3");jumpSlider3.addEventListener("input",slider3Change);function slider3Change(){output3.innerHTML=jumpSlider3.value}var output4=document.getElementById("demo4");var jumpSlider4=document.getElementById("jumpFactor4");jumpSlider4.addEventListener("input",slider4Change);function slider4Change(){output4.innerHTML=jumpSlider4.value}var output5=document.getElementById("demo5");var jumpSlider5=document.getElementById("jumpFactor5");jumpSlider5.addEventListener("input",slider5Change);function slider5Change(){output5.innerHTML=jumpSlider5.value}var output6=document.getElementById("demo6");var jumpSlider6=document.getElementById("jumpFactor6");jumpSlider6.addEventListener("input",slider6Change);function slider6Change(){output6.innerHTML=jumpSlider6.value}var output7=document.getElementById("demo7");var jumpSlider7=document.getElementById("jumpFactor7");jumpSlider7.addEventListener("input",slider7Change);function slider7Change(){output7.innerHTML=jumpSlider7.value}var output8=document.getElementById("demo8");var jumpSlider8=document.getElementById("jumpFactor8");jumpSlider8.addEventListener("input",slider8Change);function slider8Change(){output8.innerHTML=jumpSlider8.value}var output9=document.getElementById("demo9");var jumpSlider9=document.getElementById("jumpFactor9");jumpSlider9.addEventListener("input",slider9Change);function slider9Change(){output9.innerHTML=jumpSlider9.value}var output10=document.getElementById("demo10");var jumpSlider10=document.getElementById("jumpFactor10");jumpSlider10.addEventListener("input",slider10Change);function slider10Change(){output10.innerHTML=jumpSlider10.value}var output10b=document.getElementById("demo10b");var jumpSlider10b=document.getElementById("jumpFactor10b");jumpSlider10b.addEventListener("input",slider10bChange);function slider10bChange(){output10b.innerHTML=jumpSlider10b.value}var output11=document.getElementById("demo11");var jumpSlider11=document.getElementById("jumpFactor11");jumpSlider11.addEventListener("input",slider11Change);function slider11Change(){output11.innerHTML=jumpSlider11.value}var output12=document.getElementById("demo12");var jumpSlider12=document.getElementById("jumpFactor12");jumpSlider12.addEventListener("input",slider12Change);function slider12Change(){output12.innerHTML=jumpSlider12.value}function clearConsole(){document.getElementById("console").innerHTML="";consoleEntries=0}function updateCells(){if(version>1.6){var p=document.getElementById("checkbox10").checked;if(p==true){document.getElementById("checkbox12").disabled=true;document.getElementById("switch12").style.cursor="default"}else{document.getElementById("checkbox12").disabled=false;document.getElementById("switch12").style.cursor="pointer"}}var q=document.getElementById("checkbox0").checked;if(q==true){document.getElementById("row5").disabled=true}else{document.getElementById("row5").disabled=false}var r=document.getElementById("checkbox1").checked;if(r==true){document.getElementById("row6").disabled=true}else{document.getElementById("row6").disabled=false}if(q==true||r==true){document.getElementById("row3").disabled=true}else{document.getElementById("row3").disabled=false}var s=document.getElementById("checkbox2").checked;if(s==true){document.getElementById("row7").disabled=true}else{document.getElementById("row7").disabled=false}if(r==true||s==true){document.getElementById("row4").disabled=true}else{document.getElementById("row4").disabled=false}for(var i=0;i<8;i++){var x=document.getElementById("row"+i).value;var t=document.getElementById("row"+i).disabled;if(x!=1||t==true){document.getElementById("MIDIrow"+i).disabled=true;document.getElementById("channel"+i).disabled=true;document.getElementById("byte2_"+i).disabled=true;document.getElementById("byte3_"+i).disabled=true}else{document.getElementById("MIDIrow"+i).disabled=false;document.getElementById("channel"+i).disabled=false;document.getElementById("byte2_"+i).disabled=false;document.getElementById("byte3_"+i).disabled=false}var y=document.getElementById("MIDIrow"+i).value;if(y==2){document.getElementById("byte3_"+i).disabled=true}if(y>2){document.getElementById("byte2_"+i).disabled=true;document.getElementById("byte3_"+i).disabled=true}var z=document.getElementById("row"+i).value;if(y==0&&i<3&&x==1||(version>1.4||version=="Unknown")&&i<3&&(z==5||z==6||z==10||z==11)){document.getElementById("checkbox"+i).disabled=false;document.getElementById("switch"+i).style.cursor="pointer"}if((y!=0&&i<3||i<3&&(x==0||x>1))&&!((version>1.4||version=="Unknown")&&i<3&&(z==5||z==6||z==10||z==11))){document.getElementById("checkbox"+i).disabled=true;document.getElementById("switch"+i).style.cursor="default";document.getElementById("checkbox"+i).checked=false}var q=document.getElementById("checkbox0").checked;if(q==true){document.getElementById("row5").disabled=true}else{document.getElementById("row5").disabled=false}var r=document.getElementById("checkbox1").checked;if(r==true){document.getElementById("row6").disabled=true}else{document.getElementById("row6").disabled=false}if(q==true||r==true){document.getElementById("row3").disabled=true}else{document.getElementById("row3").disabled=false}var s=document.getElementById("checkbox2").checked;if(s==true){document.getElementById("row7").disabled=true}else{document.getElementById("row7").disabled=false}if(r==true||s==true){document.getElementById("row4").disabled=true}else{document.getElementById("row4").disabled=false}}var z=$("#fingeringSelect0 option:selected").text();document.getElementById("fingeringLabel1").innerHTML=z;var z=$("#fingeringSelect1 option:selected").text();document.getElementById("fingeringLabel2").innerHTML=z;var z=$("#fingeringSelect2 option:selected").text();document.getElementById("fingeringLabel3").innerHTML=z}function MIDIvalueChange(){for(var i=0;i<8;i++){var x=document.getElementById("channel"+i).value;if((x<0||x>16||isNaN(x))&&!document.getElementById("channel"+i).disabled){alert("Value must be 1-16.");document.getElementById("channel"+i).value=null}}for(var j=0;j<8;j++){var y=document.getElementById("channel"+j).value;var x=document.getElementById("byte2_"+j).value;if(x<0||x>127||isNaN(x)){alert("Value must be 0-127.");document.getElementById("byte2_"+j).value=null}if(y==7&&x>101&&x<120){alert("This CC range on channel 7 is reserved for the Configuration Tool.");document.getElementById("byte2_"+j).value=null}}for(var k=0;k<8;k++){var x=document.getElementById("byte3_"+k).value;if(x<0||x>127||isNaN(x)){alert("Value must be 0-127.");document.getElementById("byte3_"+k).value=null}}}var AudioContextFunc=window.AudioContext||window.webkitAudioContext;var audioContext=new AudioContextFunc;var player=new WebAudioFontPlayer;player.loader.decodeAfterLoading(audioContext,"_tone_0650_SBLive_sf2");function topNavFunction(){var x=document.getElementById("myTopnav");if(x.className==="topnav"){x.className+=" responsive"}else{x.className="topnav"}}function sleep(ms){return new Promise(resolve=>setTimeout(resolve,ms))}function importPreset(context){if(!WARBLout){document.getElementById("modal14-title").innerHTML="Preset import only allowed when WARBL is connected";document.getElementById("modal14-ok").style.opacity=1;modal(14);return}var maxSupportedPresetVersion=1;var delay=5;if(context.files&&context.files.length!=0){var fname=context.files[0].name;fname=fname.replace(".warbl","");fname=fname.replace(".WARBL","");document.getElementById("modal14-title").innerHTML="Importing: "+context.files[0].name;document.getElementById("modal14-ok").style.opacity=.001;modal(14);var reader=new FileReader;reader.onload=async function(){try{var theImportObject=JSON.parse(reader.result)}catch(e){document.getElementById("modal14-title").innerHTML="Error: File is not a WARBL Preset";return}if(!theImportObject){document.getElementById("modal14-title").innerHTML="Error: File is not a WARBL Preset";return}if(!theImportObject.signature||theImportObject.signature!="WARBL"){document.getElementById("modal14-title").innerHTML="Error: File is not a WARBL Preset";return}if(!theImportObject.version){document.getElementById("modal14-title").innerHTML="Error: File is not a WARBL Preset";return}if(theImportObject.version>maxSupportedPresetVersion){document.getElementById("modal14-title").innerHTML="Error: WARBL Preset Version "+theImportObject.version+" not supported by this version of the configuration tool";return}var nMessages=theImportObject.messages.length;var i;var byte0,byte1,byte2;byte0=theImportObject.messages[0][0];byte1=theImportObject.messages[0][1];byte2=theImportObject.messages[0][2];sendToWARBL(byte1,byte2);await sleep(delay);var exportedInstrument=theImportObject.messages[10][2]-60;var targetInstrument=30+instrument;var targetKey=111+instrument;switch(exportedInstrument){case 0:byte0=theImportObject.messages[1][0];byte1=theImportObject.messages[1][2];byte2=targetInstrument;sendToWARBL(byte1,byte2);await sleep(delay);byte0=theImportObject.messages[2][0];byte1=theImportObject.messages[2][1];byte2=theImportObject.messages[2][2];sendToWARBL(byte1,byte2);await sleep(delay);byte0=theImportObject.messages[3][0];byte1=targetKey;byte2=theImportObject.messages[3][2];sendToWARBL(byte1,byte2);await sleep(delay);break;case 1:byte0=theImportObject.messages[4][0];byte1=theImportObject.messages[4][1];byte2=targetInstrument;sendToWARBL(byte1,byte2);await sleep(delay);byte0=theImportObject.messages[5][0];byte1=theImportObject.messages[5][1];byte2=theImportObject.messages[5][2];sendToWARBL(byte1,byte2);await sleep(delay);byte0=theImportObject.messages[6][0];byte1=targetKey;byte2=theImportObject.messages[6][2];sendToWARBL(byte1,byte2);await sleep(delay);break;case 2:byte0=theImportObject.messages[7][0];byte1=theImportObject.messages[7][1];byte2=targetInstrument;sendToWARBL(byte1,byte2);await sleep(delay);byte0=theImportObject.messages[8][0];byte1=theImportObject.messages[8][1];byte2=theImportObject.messages[8][2];sendToWARBL(byte1,byte2);await sleep(delay);byte0=theImportObject.messages[9][0];byte1=targetKey;byte2=theImportObject.messages[9][2];sendToWARBL(byte1,byte2);await sleep(delay);break}for(i=12;i<nMessages;++i){byte0=theImportObject.messages[i][0];byte1=theImportObject.messages[i][1];byte2=theImportObject.messages[i][2];sendToWARBL(byte1,byte2);await sleep(delay)}setTimeout(function(){sendToWARBL(102,126);document.getElementById("modal14-title").innerHTML="Preset Import Complete!";document.getElementById("modal14-ok").style.opacity=1;setTimeout(function(){$("#importPreset").val("")},1e3)},500)};reader.readAsText(context.files[0])}}function exportPreset(){if(!WARBLout){document.getElementById("modal14-title").innerHTML="Preset export only allowed when WARBL is connected";document.getElementById("modal14-ok").style.opacity=1;modal(14);return}var nMessages=0;var theExportObject={signature:"WARBL",version:1,messages:[]};function downloadPreset(content,filename,contentType){const a=document.createElement("a");const file=new Blob([content],{type:contentType});a.href=URL.createObjectURL(file);a.download=filename;a.click();URL.revokeObjectURL(a.href);document.getElementById("modal14-title").innerHTML="Preset Export Complete!";document.getElementById("modal14-ok").style.opacity=1;modal(14)}function exportMessageHandler(byte0,byte1,byte2){theExportObject.messages.push([byte0,byte1,byte2]);nMessages++;if(nMessages==135){var theExportObjectJSON=JSON.stringify(theExportObject);gExportProxy=null;downloadPreset(theExportObjectJSON,"WARBL_Preset.warbl","text/plain")}}gExportProxy=exportMessageHandler;sendToWARBL(102,126)}function capturePressure(val){gCurrentPressure=val}function graphPressure(){gPressureReadings.pop();gPressureReadings.unshift(gCurrentPressure);$("#d3PressureGraph").empty();var margin={top:10,right:10,bottom:100,left:50},width=390,height=320-margin.top-margin.bottom;var svg=d3.select("#d3PressureGraph").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");var x=d3.scaleLinear().domain([0,width]).range([0,width]);svg.append("g").attr("transform","translate(0,"+height+")").call(d3.axisBottom(x).tickSize(0).tickFormat(""));var y=d3.scaleLinear().domain([0,gMaxPressure]).range([height,0]);svg.append("g").call(d3.axisLeft(y));svg.append("text").attr("y",height+4).attr("x",width/2-margin.left/2+10).attr("dy","1em").style("text-anchor","middle").style("fill","white").text("Time");svg.append("text").attr("transform","rotate(-90)").attr("y",0-(margin.left-5)).attr("x",0-height/2).attr("dy","1em").style("text-anchor","middle").style("fill","white").text("Inches of H₂O");var xScale=d3.scaleLinear().domain([0,gNPressureReadings-1]).range([0,width]);var yScale=d3.scaleLinear().domain([0,gMaxPressure]).range([height,0]);var line=d3.line().x(function(d,i){return xScale(i)}).y(function(d){return yScale(d.y)}).curve(d3.curveMonotoneX);var dataset=d3.range(gNPressureReadings).map(function(d){return{y:gPressureReadings[d]}});svg.append("path").datum(dataset).attr("class","pressureline").attr("d",line)}function startPressureGraph(){gPressureGraphEnabled=true;gCurrentPressure=0;var i;gPressureReadings=[];for(i=0;i<gNPressureReadings;++i){gPressureReadings.push(0)}gGraphInterval=setInterval(graphPressure,100)}function stopPressureGraph(){gPressureGraphEnabled=false;clearInterval(gGraphInterval);$("#d3PressureGraph").empty();return}